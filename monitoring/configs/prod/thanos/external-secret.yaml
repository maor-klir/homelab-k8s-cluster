apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: thanos-objstore-secret
  namespace: thanos
spec:
  refreshInterval: 1h
  secretStoreRef:
    kind: ClusterSecretStore
    name: azure-key-vault-store
  target:
    name: thanos-objstore-secret
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        objstore.yaml: |
          type: AZURE
          config:
            storage_account: "{{ .storageAccount }}"
            container: "{{ .container }}"
            # Using Azure Workload Identity for authentication
            msi_resource: ""
  data:
    - secretKey: storageAccount
      remoteRef:
        key: thanos-storage-account
    - secretKey: container
      remoteRef:
        key: thanos-storage-container
