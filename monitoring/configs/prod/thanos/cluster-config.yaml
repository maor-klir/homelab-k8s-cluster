apiVersion: v1
kind: ConfigMap
metadata:
  name: thanos-cluster-config
  namespace: thanos
data:
  values.yaml: |
    # Production-specific Thanos configuration (stevehipwell/thanos chart)

    # Global service account for Workload Identity
    serviceAccount:
      create: false
      name: workload-identity-sa

    # Compact - Use shared service account
    compact:
      serviceAccount:
        create: false
        name: workload-identity-sa

    # Store Gateway - Use shared service account
    storeGateway:
      serviceAccount:
        create: false
        name: workload-identity-sa

    # Receive Ingestor - Higher resources for production
    receive:
      serviceAccount:
        create: false
        name: workload-identity-sa
      ingestor:
        replicas: 2
        resources:
          requests:
            memory: "1Gi"
            cpu: "500m"
          limits:
            memory: "2Gi"
            cpu: "2000m"
      router:
        replicas: 2
        resources:
          requests:
            memory: "256Mi"
            cpu: "100m"
          limits:
            memory: "512Mi"
            cpu: "500m"

    # Query - Production scaling
    query:
      replicas: 2
      extraArgs:
        - --query.auto-downsampling
      resources:
        requests:
          memory: "512Mi"
          cpu: "200m"
        limits:
          memory: "1Gi"
          cpu: "1000m"

    # Query Frontend
    queryFrontend:
      replicas: 2
      resources:
        requests:
          memory: "256Mi"
          cpu: "100m"
        limits:
          memory: "512Mi"
          cpu: "500m"

    # Store Gateway - Production scaling
    storeGateway:
      replicas: 2
      resources:
        requests:
          memory: "512Mi"
          cpu: "200m"
        limits:
          memory: "1Gi"
          cpu: "1000m"

    # Compact - Production scaling
    compact:
      resources:
        requests:
          memory: "512Mi"
          cpu: "200m"
        limits:
          memory: "1Gi"
          cpu: "1000m"
