apiVersion: v1
kind: ConfigMap
metadata:
  name: thanos-values
  namespace: thanos
data:
  values.yaml: |
    # ============================================
    # GLOBAL CONFIGURATION
    # ============================================
    logLevel: info
    logFormat: logfmt

    # ============================================
    # OBJECT STORAGE CONFIGURATION
    # ============================================
    objstoreConfig:
      create: false
      name: thanos-objstore-secret
      key: objstore.yaml

    # ============================================
    # SERVICE MONITOR
    # ============================================
    serviceMonitor:
      enabled: true
      additionalLabels: {}

    # ============================================
    # ADDITIONAL REPLICA LABELS
    # ============================================
    additionalReplicaLabels:
      - prometheus_replica
      - replica

    # ============================================
    # THANOS COMPACT
    # ============================================
    compact:
      enabled: true
      deduplication:
        enabled: true
      serviceAccount:
        create: true
        automountToken: false
      resources:
        requests:
          memory: "256Mi"
          cpu: "100m"
        limits:
          memory: "512Mi"
          cpu: "500m"
      persistence:
        enabled: true
        accessMode: ReadWriteOnce
        size: 20Gi

    # ============================================
    # THANOS QUERY
    # ============================================
    query:
      enabled: true
      enableDnsDiscovery: true
      serviceAccount:
        create: true
        automountToken: false
      service:
        type: ClusterIP
        grpcPort: 10901
        httpPort: 10902
      replicas: 2
      resources:
        requests:
          memory: "256Mi"
          cpu: "100m"
        limits:
          memory: "512Mi"
          cpu: "500m"

    # ============================================
    # THANOS QUERY FRONTEND
    # ============================================
    queryFrontend:
      enabled: true
      serviceAccount:
        create: true
        automountToken: false
      service:
        type: ClusterIP
        httpPort: 10902
      replicas: 1
      resources:
        requests:
          memory: "128Mi"
          cpu: "50m"
        limits:
          memory: "256Mi"
          cpu: "250m"

    # ============================================
    # THANOS RECEIVE (Ingestor + Router)
    # ============================================
    receive:
      enabled: true
      replicationFactor: 1
      retention: 6h
      ingestor:
        serviceAccount:
          create: true
          automountToken: false
        service:
          grpcPort: 10901
          httpPort: 10902
          httpRemoteWritePort: 19291
        replicas: 2
        resources:
          requests:
            memory: "512Mi"
            cpu: "250m"
          limits:
            memory: "1Gi"
            cpu: "1000m"
        persistence:
          enabled: true
          accessMode: ReadWriteOnce
          size: 20Gi
      router:
        serviceAccount:
          create: true
          automountToken: false
        service:
          grpcPort: 10901
          httpPort: 10902
          httpRemoteWritePort: 19291
          type: ClusterIP
        replicas: 1
        resources:
          requests:
            memory: "128Mi"
            cpu: "50m"
          limits:
            memory: "256Mi"
            cpu: "250m"

    # ============================================
    # THANOS RULE - Disabled (using Grafana Alerting)
    # ============================================
    rule:
      enabled: false

    # ============================================
    # THANOS STORE GATEWAY
    # ============================================
    storeGateway:
      enabled: true
      serviceAccount:
        create: true
        automountToken: false
      service:
        grpcPort: 10901
        httpPort: 10902
      replicas: 1
      resources:
        requests:
          memory: "256Mi"
          cpu: "100m"
        limits:
          memory: "512Mi"
          cpu: "500m"
      persistence:
        enabled: true
        accessMode: ReadWriteOnce
        size: 10Gi
